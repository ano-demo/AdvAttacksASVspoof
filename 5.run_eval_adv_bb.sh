# Description: run eval_adv_bb.py with different models and adv samples
# EXPERIMENT 1: attack SENet using adversarial samples generated by LCNN
# MODELS
# NEW DISTILLED model, trained with clipped frequencies /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221129_153659
# NON DISTILLED model, trained with clipped frequencies /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221130_130922_nondistilled_clipped 

# SENet34: /data/longnv/_saved/models/LA_SENet34_LPSseg_uf_seg600/20221110_120043_BS512_LR0.00001/model_best.pth
# SENet12: /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221116_175342_NODISTILLED/model_best.pth

# ADVERSARIAL DATA
# old lcnn half non-clipped /data/longnv/_saved/models/LA_lcnnHalf_LPSseg_uf_seg600/20221115_112707/fgsm_adv_egs_None_5.0
# old lcnn non-clipped /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/fgsm_adv_egs_None_5.0
# new lcnn full clipped /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221128_173044/fgsm_adv_egs_None_5.0
# new lcnn half clipped /data/longnv/_saved/models/LA_lcnnHalf_LPSseg_uf_seg600/20221129_184127/fgsm_adv_egs_None_5.0

# EXPERIMENT 2: attack LCNN using adversarial samples generated by SENet
# MODELS



# GPU=3

# echo "attack new non-distilled (clipped) model using new adv samples"

# for i in `seq 13 19`; do echo $i;
# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221130_130922_nondistilled_clipped/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221130_SENet12_NOdistilled_clipped.text

# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221130_130922_nondistilled_clipped/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221128_173044/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221130_SENet12_NOdistilled_clipped.text

# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221130_130922_nondistilled_clipped/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnnHalf_LPSseg_uf_seg600/20221129_184127/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221130_SENet12_NOdistilled_clipped.text
# done 

# echo done
# exit
# exit()

GPU=3
echo "attack non-distilled LCNN model, trained with original data"

# for i in 4 6 10 14 18 33 38 41 42 49 57 62 86; do echo $i;
for i in `seq 1 8`; do echo $i;

	python eval_adv.py  --resume /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/checkpoint-epoch${i}.pth \
						--adv_data /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221116_193008_NODISTILLED/fgsm_adv_egs_None_5.0 \
						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
						--device ${GPU}	| tee -a LCNN_original.text

	python eval_adv.py  --resume /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/checkpoint-epoch${i}.pth \
						--adv_data /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221130_130922_nondistilled_clipped/fgsm_adv_egs_None_5.0 \
						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
						--device ${GPU}	| tee -a LCNN_original.text

	python eval_adv.py  --resume /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/checkpoint-epoch${i}.pth \
						--adv_data /data/longnv/_saved/models/LA_SENet34_LPSseg_uf_seg600/20221110_120043_BS512_LR0.00001/fgsm_adv_egs_None_5.0 \
						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
						--device ${GPU}	| tee -a LCNN_original.text

	python eval_adv.py  --resume /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/checkpoint-epoch${i}.pth \
						--adv_data /data/longnv/_saved/models/LA_SENet34_LPSseg_uf_seg600/20221129_134503_e4/fgsm_adv_egs_None_5.0 \
						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
						--device ${GPU}	| tee -a LCNN_original.text				
done

echo done
exit
exit()

# GPU=2
# echo "attack non-distilled SENet12 model using new adv samples"


# for i in `seq 1 13`; do echo $i;
# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221116_175342_NODISTILLED/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221129_SENet12_NOdistilled.text

# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221116_175342_NODISTILLED/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221128_173044/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221129_SENet12_NOdistilled.text

# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet12_LPSseg_uf_seg600/20221116_175342_NODISTILLED/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnnHalf_LPSseg_uf_seg600/20221129_184127/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221129_SENet12_NOdistilled.text
# done

# echo done
# exit
# exit()

# GPU=1
# echo "attack big model using new adv samples"


# for i in 4 6 10 14 18 33 38 41 42 49 57 62 86; do echo $i;
# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet34_LPSseg_uf_seg600/20221110_120043_BS512_LR0.00001/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221114_211710/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221129_SENet34.text

# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet34_LPSseg_uf_seg600/20221110_120043_BS512_LR0.00001/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnn_LPSseg_uf_seg600/20221128_173044/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221129_SENet34.text

# 	python eval_adv.py    --resume /data/longnv/_saved/models/LA_SENet34_LPSseg_uf_seg600/20221110_120043_BS512_LR0.00001/checkpoint-epoch${i}.pth \
# 						--adv_data /data/longnv/_saved/models/LA_lcnnHalf_LPSseg_uf_seg600/20221129_184127/fgsm_adv_egs_None_5.0 \
# 						--protocol_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 						--asv_score_file /data/Dataset/ASVspoof/LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt  \
# 						--device ${GPU}	| tee -a 20221129_SENet34.text
# done 

# echo done
# exit
# exit()


# sysid=A11
# epsilon=100.0
# LCNN model
# python eval3_adv.py    --resume _saved/models/LA_lcnn_LPSseg_uf_seg600/20190620_121836/checkpoint-epoch3.pth \
# 					   --adv_data _saved/models/LA_lcnn_LPSseg_uf_seg600/20190620_121836/fgsm_adv_egs_${sysid}_${epsilon} \
# 	                   --protocol_file data_LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl_${sysid}.txt \
# 	                   --asv_score_file data_LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores_${sysid}.txt \
# 	                   --device ${GPU}

# origin performance of adv. attack
# python eval3_adv.py    --resume _saved/models/LA_SENet12_LPSseg_uf_seg600/20190623_182148/model_best.pth \
# 					   --adv_data _saved/models/LA_SENet34_LPSseg_uf_seg600/20190623_093457/fgsm_adv_egs_${sysid}_${epsilon} \
# 	                   --protocol_file data_LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl_${sysid}.txt \
# 	                   --asv_score_file data_LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores_${sysid}.txt \
# 	                   --device ${GPU}

# Conduct black-box attack
# python eval3_adv.py    --resume _saved/models/LA_lcnn_LPSseg_uf_seg600/20190620_121836/checkpoint-epoch3.pth \
# 					   --adv_data _saved/models/LA_SENet12_LPSseg_uf_seg600/20190623_182148/fgsm_adv_egs_${sysid}_${epsilon} \
# 	                   --protocol_file data_LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl_${sysid}.txt \
# 	                   --asv_score_file data_LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores_${sysid}.txt \
# 	                   --device ${GPU}	                 

# Conduct black-box attack
# python eval3_adv.py    --resume _saved/models/LA_SENet12_LPSseg_uf_seg600/20190623_182148/checkpoint-epoch8.pth \
# 					   --adv_data _saved/models/LA_lcnn_LPSseg_uf_seg600/20190620_121836/fgsm_adv_egs_${sysid}_${epsilon} \
# 	                   --protocol_file data_LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl_${sysid}.txt \
# 	                   --asv_score_file data_LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores_${sysid}.txt \
# 	                   --device ${GPU}	

# for epsilon in 0.1 1.0 5.0 10.0 25.0 50.0 100.0 # LA_lcnn_LPSseg_uf_seg600/20190620_121836/checkpoint-epoch3.pth
# do
# 	# Conduct black-box attack
# 	python eval3_adv.py    --resume _saved/models/LA_lcnn_LPSseg_uf_seg600/20190620_121836/checkpoint-epoch3.pth \
# 						   --adv_data _saved/models/LA_SENet12_LPSseg_uf_seg600/20190623_182148/fgsm_adv_egs_None_${epsilon} \
# 		                   --protocol_file data_LA/ASVspoof2019_LA_cm_protocols/ASVspoof2019.LA.cm.eval.trl.txt \
# 		                   --asv_score_file data_LA/ASVspoof2019_LA_asv_scores/ASVspoof2019.LA.asv.eval.gi.trl.scores.txt \
# 		                   --device ${GPU}		                  
# done
# test